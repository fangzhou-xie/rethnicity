<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `rethnicity` package • rethnicity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to `rethnicity` package">
<meta property="og:description" content="rethnicity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rethnicity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_usage.html">Using Customized Models</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to `rethnicity` package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fangzhou-xie/rethnicity/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>rethnicity</code>
package</h1>
                        <h4 data-toc-skip class="author">Fangzhou
Xie</h4>
            
            <h4 data-toc-skip class="date">March 02, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fangzhou-xie/rethnicity/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>In this package, I aim to provide a function that could predict
ethnicity (race) from names.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fangzhou-xie/rethnicity" class="external-link">rethnicity</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── WARNING! ────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; • The method provided by this package has its limitations and anyone must use</span></span>
<span><span class="co">#&gt; them cautiously and responsibly.</span></span>
<span><span class="co">#&gt; • You should also agree that you only intend to use the method for academic</span></span>
<span><span class="co">#&gt; research purpose and not for commercial use.</span></span>
<span><span class="co">#&gt; • You would also agree NOT to discriminate anyone based on race or color or any</span></span>
<span><span class="co">#&gt; characteristic, with the information provided by this package.</span></span>
<span><span class="co">#&gt; • Please refer to the documentation for details:</span></span>
<span><span class="co">#&gt; https://fangzhou-xie.github.io/rethnicity/index.html</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<div class="section level2">
<h2 id="warning">WARNING!<a class="anchor" aria-label="anchor" href="#warning"></a>
</h2>
<p>I created this package hoping to help applied researchers on their
studies regarding ethnic bias and discrimination, and potentially
eliminate the racial and ethnic disparities. By using this package, you
agree to the following:</p>
<ol style="list-style-type: decimal">
<li>You <strong>will NOT</strong> use this package for purposes other
than academic research.</li>
<li>You <strong>will NOT</strong> disclose the predicted ethnic group to
the public, given the names data you might have.</li>
<li>You <strong>will NOT</strong> discriminate anyone on the basis of
race and color, by using the methods provided by this package.</li>
<li>You <strong>understand</strong> that the method cannot make
predictions 100% correct, and you should be cautious about the results.
<!-- 4. You **agree** to advocate racial equality. -->
</li>
</ol>
<p>Again, you should use the package responsibly.</p>
</div>
<div class="section level2">
<h2 id="getting-to-use-the-package-in-5-minutes">Getting to use the package in 5 minutes<a class="anchor" aria-label="anchor" href="#getting-to-use-the-package-in-5-minutes"></a>
</h2>
<div class="section level3">
<h3 id="i-want-to-predict-ethnicity-from-last-names">I want to predict ethnicity from last names!<a class="anchor" aria-label="anchor" href="#i-want-to-predict-ethnicity-from-last-names"></a>
</h3>
<p>Sure. I have trained a model to predict and classify race based on
last names. Simply use it as:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_ethnicity.html">predict_ethnicity</a></span><span class="op">(</span>lastnames <span class="op">=</span> <span class="st">"Jackson"</span>, method <span class="op">=</span> <span class="st">"lastname"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   lastname prob_asian prob_black prob_hispanic prob_white  race</span></span>
<span><span class="co">#&gt; 1  Jackson 0.02337379  0.8985271   0.007418938 0.07068022 black</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-if-i-have-both-first-names-and-last-names">What if I have both first names and last names?<a class="anchor" aria-label="anchor" href="#what-if-i-have-both-first-names-and-last-names"></a>
</h3>
<p>Of course. There is a separate model just to do that. By having both
first names and last names, we can achieve higher accuracy than only
having last names. The syntax is similar to what we have seen from
above.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_ethnicity.html">predict_ethnicity</a></span><span class="op">(</span>firstnames <span class="op">=</span> <span class="st">"Samuel"</span>, lastnames <span class="op">=</span> <span class="st">"Jackson"</span>, method <span class="op">=</span> <span class="st">"fullname"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   firstname lastname prob_asian prob_black prob_hispanic prob_white  race</span></span>
<span><span class="co">#&gt; 1    Samuel  Jackson 0.01741119  0.8898849   0.006667824  0.0860361 black</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-if-i-have-multiple-names">What if I have multiple names?<a class="anchor" aria-label="anchor" href="#what-if-i-have-multiple-names"></a>
</h3>
<p>Cool. I got you covered. Just use vectors as input.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">firstnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Samuel"</span>, <span class="st">"Will"</span><span class="op">)</span></span>
<span><span class="va">lastnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Jackson"</span>, <span class="st">"Smith"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/predict_ethnicity.html">predict_ethnicity</a></span><span class="op">(</span>lastnames <span class="op">=</span> <span class="va">lastnames</span>, method <span class="op">=</span> <span class="st">"lastname"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   lastname prob_asian prob_black prob_hispanic prob_white  race</span></span>
<span><span class="co">#&gt; 1  Jackson 0.02337379  0.8985271   0.007418938 0.07068022 black</span></span>
<span><span class="co">#&gt; 2    Smith 0.08850799  0.5421597   0.033163066 0.33616929 black</span></span>
<span><span class="fu"><a href="../reference/predict_ethnicity.html">predict_ethnicity</a></span><span class="op">(</span>firstnames <span class="op">=</span> <span class="va">firstnames</span>, lastnames <span class="op">=</span> <span class="va">lastnames</span>, method <span class="op">=</span> <span class="st">"fullname"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   firstname lastname prob_asian prob_black prob_hispanic prob_white  race</span></span>
<span><span class="co">#&gt; 1    Samuel  Jackson 0.01741119  0.8898849   0.006667824  0.0860361 black</span></span>
<span><span class="co">#&gt; 2      Will    Smith 0.04450592  0.5568276   0.007727880  0.3909386 black</span></span></code></pre></div>
<p>Just remember to have the same length for the <code>firstnames</code>
and <code>lastnames</code> vectors and the first name and last name for
the same person should have same index in each of the vectors.</p>
</div>
<div class="section level3">
<h3 id="wait--i-want-to-predict-a-million-names">Wait. I want to predict a million names!<a class="anchor" aria-label="anchor" href="#wait--i-want-to-predict-a-million-names"></a>
</h3>
<p>Alright. The package also supports extremely fast execution by
multi-threading via the wonderful <code>RcppThread</code> package. To
use this, just pass a number to the <code>threads</code> argument and
the number need to be greater than 0.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">firstnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Samuel"</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">lastnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Jackson"</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co"># measure the elapsed time</span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_ethnicity.html">predict_ethnicity</a></span><span class="op">(</span>firstnames <span class="op">=</span> <span class="va">firstnames</span>, lastnames <span class="op">=</span> <span class="va">lastnames</span>, threads <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 0.616348 secs</span></span></code></pre></div>
<p>Processing ten thousands names only spent around 0.64 seconds for us.
I would call this pretty fast.</p>
<p>For most use cases that I can imagine, the default setting
(<code>threads = 0</code>) should be fast enough since we are leveraging
C++ routines for the processing. If you have very large dataset, or if
you have a powerful machine, or if you just want to run the code faster,
you can set the <code>threads</code> argument to be bigger than 0 and
you should observe performance boost.</p>
<p>You may need to wisely choose the appropriate number of threads for
the job. In general, the more threads you have, the faster it should
run. But the relationship is not linear, as there will be more overhead
when increasing the number of threads. In the example, I was choosing
the number of threads by the maximum number minus 2 (24 - 2 = 22).</p>
<!-- ```{r} -->
<!-- lastnames <- rep("Freeman", 1000000) -->
<!-- # measure the elapsed time -->
<!-- start_time <- Sys.time() -->
<!-- p <- predict_ethnicity(lastnames = lastnames, method = "lastname", threads = 10) -->
<!-- end_time <- Sys.time() -->
<!-- end_time - start_time -->
<!-- ``` -->
</div>
</div>
<div class="section level2">
<h2 id="faq">FAQ<a class="anchor" aria-label="anchor" href="#faq"></a>
</h2>
<div class="section level3">
<h3 id="how-did-you-train-the-models">How did you train the models?<a class="anchor" aria-label="anchor" href="#how-did-you-train-the-models"></a>
</h3>
<p>I first trained the models in Keras with Python, using the Florida
Voter Registration dataset. After training a big model for the
prediction, I also trained a smaller model than will mimic the
prediction of large model (this is called “distillation of knowledge”).
By doing so, we could significantly reduce the size of the model while
keeping the accuracy. This is very important if we want the package to
be lightweight and fast in processing data.</p>
</div>
<div class="section level3">
<h3 id="how-did-you-create-the-package-with-keras-models">How did you create the package with Keras models?<a class="anchor" aria-label="anchor" href="#how-did-you-create-the-package-with-keras-models"></a>
</h3>
<p>After the training and testing process, I save the distilled model
and export it into C++ by the <code>frugally-deep</code> project. This
will allow us to get rid of the dependency on Keras and Python and we
can directly making inferences from C++. From here, it is very obvious
that we can wrap the inference procedure by <code>Rcpp</code> and call
it from R.</p>
<p>Note that one could potentially use the <code>keras</code> package in
R to load Keras models trained in Python. But I believe this would have
defeated the purpose of having a R package, as the <code>keras</code>
package still depends on Python and the installation of Keras. You can
argue that we are actually still using Python:)</p>
</div>
<div class="section level3">
<h3 id="what-is-the-difference-between-fullname-model-vs--lastname-model">What is the difference between <code>fullname</code> model
vs. <code>lastname</code> model?<a class="anchor" aria-label="anchor" href="#what-is-the-difference-between-fullname-model-vs--lastname-model"></a>
</h3>
<!-- TODO: potentially cite my article in later CRAN submission -->
<p>I have trained two different model for predicting ethnicity from
names, one only leverages last names, while another incorporate both
first names and last names. In some applications, researchers may only
have access to last names, then they should consider using the
<code>lastname</code> method. In other cases, we could also have first
names available, then we could incorporate this information and use the
<code>fullname</code> method. This will yield better accuracy for the
prediction.</p>
</div>
<div class="section level3">
<h3 id="what-about-the-performance-of-the-package">What about the performance of the package?<a class="anchor" aria-label="anchor" href="#what-about-the-performance-of-the-package"></a>
</h3>
<p>The processing speed is super fast, as the heavy-lifting has been
delegated to the underlying C++. What is more, to make it even faster, I
used <code>RcppThread</code> to achieve multi-threading. This would be
extremely useful if you have a very large dataset at hand. As shown in
the example above, we have achieved to process a million names within 10
seconds. In other words, we could predict the race from a name by 10 μs
on average.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Fangzhou Xie.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
